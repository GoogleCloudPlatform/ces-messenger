<!--
 @license
 Copyright 2025 Google LLC
 SPDX-License-Identifier: Apache-2.0
-->
<!DOCTYPE html>
<html lang="en">

<head>
  <title>Overriding template context</title>
  <script src="https://www.gstatic.com/ces-console/fast/ces-messenger/ces-messenger.js"></script>
  <style>
    body {
      font-family: sans-serif;
      padding: 2em;
    }
    .explanation {
      max-width: 600px;
      margin-bottom: 2em;
      border: 1px solid #ccc;
      padding: 1em;
      border-radius: 8px;
      background-color: #f9f9f9;
    }
    code {
      background-color: #eee;
      padding: 2px 4px;
      border-radius: 4px;
    }
  </style>
</head>

<body>
  <div class="explanation">
    <h2>Overriding template context</h2>
    <p>This example demonstrates how client-side template rendering is handled using Client Functions:</p>
    <ul>
      <li>Client side template rendering is done using Client Functions.</li>
      <li>A Client Function is defined on the agent with the ID of the template to use (<code>template_id</code>), and the context (<code>context</code>) as arguments.</li>
      <li>There is no need to register the function on the browser. If the chat widget sees a function call with the above mentioned arguments, but the function has not been registered on the browser, it will apply the template as-is.</li>
      <li>If, for any reason, the page needs to alter the contents of the context before it is rendered, it can register the function, and call the <code>insertRichTextMessage(template_id, context)</code> function to display the message.</li>
  </div>

  <ces-messenger
    deployment-id="projects/connectors-incubation-test-1/locations/us-east1/apps/ac2b1314-b3d1-4473-8cea-b49add9e44a8/deployments/014c3be7-2919-4d61-b641-fd5cf39e1e99"
    chat-title="Template gallery"
    token-broker-url="https://token-broker.example.com"
    initial-message="show me the the demo with ID 'button_demo'"
    hide-initial-message="false"
    audio-input-mode="NONE"
    auto-open-chat="true"
    show-error-messages="true"></ces-messenger>
</body>

<script>
window.addEventListener('ces-messenger-loaded', () => {
  const cesMessenger = document.querySelector('ces-messenger');
  cesMessenger.registerClientSideFunction(
    {
      toolName: 'projects/connectors-incubation-test-1/locations/us-east1/apps/ac2b1314-b3d1-4473-8cea-b49add9e44a8/tools/655b7482-32d9-4346-937c-f691ae8f925c',
      toolDisplayName: 'template_filler'
    },
    (args) => {
      if (args.template_id === 'cesm_button' && args.context) {
        args.context.text = 'Button text modified!';
        args.context.onclick = 'window.alert("This way you can modify the context before rendering the message.")';
      }
      cesMessenger.insertRichTextMessage(args.template_id, args.context);
      return Promise.resolve({status: 'success'});
    },
  );
})

</script>
</html>